---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import marsLogo from "../assets/images/MARSLogo.png"; // Adjust the path as necessary

// Get current path
const currentPath = Astro.url.pathname;

// Assign active class based on current path
const isActive = (path: string) => (currentPath === path ? "active" : "");

const { solidNav } = Astro.props as { solidNav?: boolean };

const people = await getCollection("people");

// Get all unique years
const years = new Set<number>();
people.forEach((person) =>
    person.data.subteams?.forEach((subteam) =>
        subteam.years?.forEach((year) => years.add(year)),
    ),
);
const latestYear = Math.max(...Array.from(years));

// Generate navigation bar
const navLinks = [
    { href: "/", label: "Home" },
    { href: `/team/${latestYear}`, label: "Team" },
    { href: "/blog", label: "Blog" },
];
---

<header class={`header ${solidNav ? "solid" : ""}`}>
    <div class="logo">
        <a href="/">
            <Image src={marsLogo} alt="MARS Logo" />
            <h2>MARS</h2>
        </a>
    </div>
    <nav class="nav" style={{ display: "flex", gap: "20px" }}>
        {
            navLinks.map((link) => (
                <a href={link.href} class={isActive(link.href)}>
                    {link.label}
                </a>
            ))
        }
    </nav>
</header>
{solidNav && <div style="height: 80px;" />}

<script>
    // Add scroll event listener to change header style on scroll
    window.addEventListener("scroll", () => {
        const header = document.querySelector(".header");

        if (!header) return;

        if (window.scrollY > 50) {
            header.classList.add("scrolled");
        } else {
            header.classList.remove("scrolled");
        }
    });
</script>

<style>
    .header {
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        position: fixed;
        top: 0;
        width: 100%;
        height: 80px;
        background-color: transparent;
        transition:
            background-color 0.3s,
            color 0.3s;
        color: white;
    }

    .header.scrolled,
    .header.solid {
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        background-color: white;
        top: 0px;
    }

    .header .logo {
        display: flex;
        align-items: center;
        font-weight: bold;
        height: 60px;
    }

    .header .logo > * {
        display: none;
        align-items: center;
        gap: 10px;
        text-decoration: none;
    }

    .header.scrolled .logo > *,
    .header.solid .logo > * {
        display: flex;
    }

    .nav a {
        text-decoration: none;
        font-size: 1.2em;
        color: inherit;
        font-weight: normal;
        padding: 10px 20px;
        border-radius: 20px;
        background-color: rgba(255, 255, 255, 0.2);
        transition:
            background-color 0.3s,
            color 0.3s,
            border 0.3s;
        font-weight: bold;
        border: 3px rgba(0, 0, 0, 0) solid;
        display: inline-block;
        height: 100%;
    }

    .header .logo a {
        height: 100%;
        margin: 0;
        margin-right: 10px;
    }

    .header .logo img {
        height: 100%;
        width: auto;
    }

    .header .logo h2 {
        font-size: 2.5rem;
        color: black;
    }

    .header.scrolled .nav a,
    .header.solid .nav a {
        color: black;
        border: 3px #222b48 solid;
        transition: transform 0.3s ease;
    }

    .nav a.active {
        background-color: white;
        color: black;
    }

    .header.scrolled .nav a.active,
    .header.solid .nav a.active {
        background-color: #222b48;
        color: white;
    }

    .nav a:hover {
        background-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.1);
    }

    @media (max-width: 768px) {
        .header {
            padding: 10px 15px;
        }

        .header .logo h2 {
            font-size: 1.8rem;
        }

        .nav {
            gap: 5px;
        }

        .nav a {
            font-size: 1rem;
            padding: 8px 12px;
        }
    }

    @media (max-width: 480px) {
        .header {
            padding: 10px;
        }

        .header .logo h2 {
            font-size: 1.5rem;
        }

        .nav {
            gap: 3px;
        }

        .nav a {
            font-size: 0.85rem;
            padding: 6px 10px;
        }
    }
</style>
